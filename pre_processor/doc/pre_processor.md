<!-- pre_processor.md, m3u8_dl-js_GUI/pre_processor/doc/
  lang: zh_CN
-->
(`zh_CN`)

# `m3u8_dl-js_GUI` 预处理程序 接口规范
`version 0.1.0`


## 1. 概述

`m3u8_dl-js_GUI` (以下 简称 `GUI`) 使用 **预处理程序** (`pre_processor`) 来
增强 其功能.

预处理程序 可以使用 **任意** 编程语言 实现, 目前 至少支持:

+ `python 3`  (python 3.6 运行环境)
+ `nodejs`  (node v8.0 运行环境)


## 2. 命令行参数 (格式)

`GUI` 使用 如下格式 调用 预处理程序:

```
  PRE_PROCESSOR OUT_FILE RAW_FILE [URL] [-- OPTIONS]
```

+ **`PRE_PROCESSOR`** <br />
  预处理程序 (可执行程序 或者 主入口文件)

+ **`OUT_FILE`** <br />
  输出文件 (文件名 / 绝对路径)

  `GUI` 期望 预处理程序 生成的文件.

+ **`RAW_FILE`** <br />
  原始文件 (文件名 / 绝对路径)

  预处理程序 的 输入文件.

+ **`URL`** (可选) <br />
  原始文件 对应 的 原始 URL

  **注**: 如果 没有 原始 URL, 那么 没有 此项 参数.

+ **`--`** (可选) <br />
  自定义参数 的 分隔符

+ **`OPTIONS`** (可选) <br />
  传递给 预处理程序 的 自定义参数 (可能 有 多个)

例如, `GUI` 使用 如下方式 (命令行 参数) 调用一个 预处理程序:

```
  python pp1.py out1 raw.m3u8 "http://test.org/1.m3u8" -- XXX YYY
```


## 3. 调用 预处理程序

`GUI` 使用如下 步骤 调用 预处理程序:

+ (1) `GUI` 下载 原始 URL 对应的 文件, 作为 原始文件 (`RAW_FILE`)

+ (2) `GUI` 使用 原始文件 路径, 原始 URL 等 作为 参数, 调用 预处理程序

+ (3) `GUI` 分析/处理 预处理程序 生成的 输出文件 (`OUT_FILE`)


## 4. 输出文件

预处理程序 可以根据 `GUI` 指定的 路径 (`OUT_FILE`), 输出 以下类型的 文件:

+ (1) **不输出** 文件 <br >
  预处理程序 没有 生成 输出文件.

  当 预处理程序 发生错误 时, 可以 不生成 输出文件.
  此时 `GUI` 将从 预处理程序 (进程) 的
  标准输出 (`stdout`) / 标准错误输出 (`stderr`) 获取 错误信息.

+ (2) 输出 **`OUT_FILE.error`** 文件

  发生错误 时, 预处理程序 也可以生成一个 文本文件, 里面含有 错误信息.

+ (3) 输出 **`OUT_FILE.m3u8`** 文件 <br />
  生成 标准格式 的 m3u8 文件.

+ (4) 输出 **`OUT_FILE.list`** 文件 <br />
  生成 列表 文件.

  此 文本文件 格式 如下:

  ```
  # 说明 (可选)
  URL
  ```

  每连续的 2 行 为 一组, 表示 列表中的 一项.
  以 `#` 字符 起始的 说明 行, 可以 省略.

  **注**: 空白行 会被 忽略.

+ (5) 输出 **`OUT_FILE.format`** 文件 <br />
  生成 多格式选择 文件.

  此 文本文件 格式 如下:

  ```
  # 格式说明
  OPTIONS
  ```

  类似 *列表* 文件, 每连续 2 行 为 一组.

  `OPTIONS` 为 需要 传递给 预处理程序 的 自定义参数.


## 5. 预处理程序 打包格式

为了方便 预处理程序 的 分发 以及 用户 使用, 可以 对 预处理程序 打包.

打包格式 为 标准的 **`zip` 压缩文件**, 后缀为 **`.zip.ppp`** .
(其中 `ppp` 表示 `Pre Processor Package` )

压缩包 根目录 下 有一个 **`pre_processor.meta.json`** 文件, 描述 预处理程序 有关信息.
此文件 格式如下:

```
// 下面 使用 javascript 语法描述 文件格式, 实际使用时 请使用 JSON 语法
{
  pp_version: '0.1.0',  // 预处理程序 接口规范 版本号 (当前 是 '0.1.0')

  id: '',       // 预处理程序 标识
  name: '',     // 此 预处理程序 用户友好 的 描述性 名称
  version: '',  // 预处理程序 版本号

  type: '',  // 预处理程序 类型, 可用 值 有: 'python3', 'nodejs', 'exe'
  main: '',  // 主文件 (可执行程序 或者 入口文件) 路径
             // (相对于此 `pre_processor.meta.json` 文件)

  // 以上 项目 是 **必须** 的, 以下 项目 是 *可选* 的
  license: '',    // LICENSE
  author: '',     // 作者
  copyright: '',
  home: '',       // 项目 (此 预处理程序) 主页 URL

  // 此外, 还允许使用 自定义项目, 自定义项目 请以 `_` (下划线) 起始
}
```


<https://github.com/nilaoda/m3u8_dl-js_GUI>

<!-- end pre_processor.md -->
